- name: Waiting for nodes to be reachable
  wait_for_connection:
    sleep: 10
    timeout: 600

- name: Gather System Info
  setup:

- name: Gather Installed Services
  service_facts:

- name: Get rid of Network Manager
  service: name=NetworkManager state=stopped enabled=no
  when: "'NetworkManager.service' in services"

- name: Disable firewall
  service: name=firewalld state=stopped enabled=no
  when: "'firewalld.service' in services"

- name: Set hostname
  command: "hostnamectl set-hostname {{ inventory_hostname_short }}.pri.{{ cluster_name }}.cluster.local"

- name: Ensure search domain exists in resolv.conf
  lineinfile:
    path: /etc/resolv.conf
    regexp: "^search (.*?)( pri.{{ cluster_name }}.cluster.local|$)"
    line: 'search \1 pri.{{ cluster_name }}.cluster.local'
    backrefs: true
    state: present

- name: Install EPEL Repo
  yum: name=epel-release state=present

- name: Add OpenFlight Release Repo
  yum: 
    name: "https://repo.openflighthpc.org/openflight/{{ ansible_distribution |lower }}/{{ ansible_distribution_major_version }}/{{ ansible_architecture }}/openflighthpc-release-2-1.noarch.rpm"
    state: present

- name: Enabling OpenFlight Development Repo
  ini_file:
    dest: /etc/yum.repos.d/openflight-dev.repo
    section: openflight-dev
    option: enabled
    value: 1
  when: flightenv_dev

